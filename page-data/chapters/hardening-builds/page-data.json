{"componentChunkName":"component---node-modules-rocketseat-gatsby-theme-docs-core-src-templates-docs-query-js","path":"/chapters/hardening-builds","result":{"data":{"mdx":{"id":"d699487f-99b1-50ab-83ea-f26c90646709","excerpt":"Given all sources including dependency definitions are trusted, we can move on to the next step --- build. Let's look back at  ../02-towards-trustful-chainsâ€¦","fields":{"slug":"/chapters/hardening-builds/"},"frontmatter":{"title":"Hardening Builds","description":null,"image":null,"disableTableOfContents":null},"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Hardening Builds\",\n  \"metaTitle\": \"TODO\",\n  \"metaDescription\": \"TODO\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Given all sources including dependency definitions are trusted, we can move on to the next step --- build. Let's look back at \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"../02-towards-trustful-chains\"\n  }, \"../02-towards-trustful-chains\"), \":\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Even if we succeed in depending on only trustworthy artifacts, we still need to ensure what we're depending on are \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"what we decided to trust at the point in time\"), \". At least we need to:\"), mdx(\"ul\", {\n    parentName: \"blockquote\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Define dependencies statically to lock them (like \", mdx(\"inlineCode\", {\n    parentName: \"strong\"\n  }, \"go.sum\"), \")\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Use locked dependencies following the definition properly\"))), mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Another challenge is that compiled binaries or containers often lack information on what it is depending on internally, resulting in operation challenges. Suppose that you see a news that a researcher found that \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"package-blah-blah\"), \" had included malwares. Once you forget what kind of tools and packages container images depends on, you'll give a big sigh and lose time. This is one of the reasons why we need to have Software Bill of Materials (SBoM).\")), mdx(\"p\", null, \"In this chapter, you'll try to build the following while generating SBoMs:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Exercise 1: a Go app container image\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Exercise 2: an Alpine-based container image\")), mdx(\"h2\", {\n    \"id\": \"preliminaries\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#preliminaries\",\n    \"aria-label\": \"preliminaries permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Preliminaries\"), mdx(\"p\", null, \"Run the following commands to install requirements:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"go install github.com/google/ko@v0.11.2\\n\")), mdx(\"h2\", {\n    \"id\": \"exercise-1-build-a-container-image-with-a-go-application-using-ko\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#exercise-1-build-a-container-image-with-a-go-application-using-ko\",\n    \"aria-label\": \"exercise 1 build a container image with a go application using ko permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Exercise 1: Build a Container Image with a Go Application Using \", mdx(\"inlineCode\", {\n    parentName: \"h2\"\n  }, \"ko\")), mdx(\"h3\", {\n    \"id\": \"build\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#build\",\n    \"aria-label\": \"build permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Build\"), mdx(\"p\", null, \"Run the following to build a Go image:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"$ pushd ./ko-src; KO_DOCKER_REPO=ttl.sh ko build ./; popd\\n\\n2022/08/11 09:04:10 No matching credentials were found, falling back on anonymous\\n2022/08/11 09:04:11 Using base gcr.io/distroless/static:nonroot@sha256:59d91a17dbdd8b785e61da81c9095b78099cad8d7757cc108f49e4fb564ef8b3 for example-app\\n2022/08/11 09:04:12 Building example-app for linux/amd64\\n2022/08/11 09:04:13 Publishing ttl.sh/example-app-22674c31fceab15d3ac4fb665ad6cc0f:latest\\n2022/08/11 09:04:18 pushed blob: sha256:22b18b6743847a8831d8d6f095a2ec44c61235f8250ac3c9bf35dd0b46c770cd\\n2022/08/11 09:04:18 pushed blob: sha256:7040c798bde084f106c5a2544c0c1994263b44c01202a22dfba3200e8a495227\\n2022/08/11 09:04:20 ttl.sh/example-app-22674c31fceab15d3ac4fb665ad6cc0f:sha256-12742d1638a6fe621a9a35b69e9d074a1883ea4aa34d62e48dfb187e92ac5388.sbom: digest: sha256:570c92ce9c5f2e1d7cb4c81bbd6e5e223018d54361c0a07caac1840af348f161 size: 368\\n2022/08/11 09:04:20 Published SBOM ttl.sh/example-app-22674c31fceab15d3ac4fb665ad6cc0f:sha256-12742d1638a6fe621a9a35b69e9d074a1883ea4aa34d62e48dfb187e92ac5388.sbom\\n2022/08/11 09:04:21 existing blob: sha256:250c06f7c38e52dc77e5c7586c3e40280dc7ff9bb9007c396e06d96736cf8542\\n2022/08/11 09:04:21 existing blob: sha256:b9f88661235d25835ef747dab426861d51c4e9923b92623d422d7ac58eb123e9\\n2022/08/11 09:04:25 pushed blob: sha256:215b1be207df3beaec417ca216a64cab240aa02f2d78f72f82fca616548fc181\\n2022/08/11 09:04:28 pushed blob: sha256:44d2ddf44b284d08e27df9724e65247715f8b6d6029f18906b397560b4aef0fe\\n2022/08/11 09:04:29 ttl.sh/example-app-22674c31fceab15d3ac4fb665ad6cc0f:latest: digest: sha256:12742d1638a6fe621a9a35b69e9d074a1883ea4aa34d62e48dfb187e92ac5388 size: 750\\n2022/08/11 09:04:29 Published ttl.sh/example-app-22674c31fceab15d3ac4fb665ad6cc0f@sha256:12742d1638a6fe621a9a35b69e9d074a1883ea4aa34d62e48dfb187e92ac5388\\nttl.sh/example-app-22674c31fceab15d3ac4fb665ad6cc0f@sha256:12742d1638a6fe621a9a35b69e9d074a1883ea4aa34d62e48dfb187e92ac5388\\n\")), mdx(\"h3\", {\n    \"id\": \"review-sbom\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#review-sbom\",\n    \"aria-label\": \"review sbom permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Review SBoM\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ko\"), \" generates a SBoM with a container image and push it to the same OCI registry. You'll see the following line in the logs above:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"2022/08/11 09:04:20 ttl.sh/<redacted>.sbom: digest: <snipped>\\n\")), mdx(\"p\", null, \"Let's check what it includes. Run the following command after replacing \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"<redacted>\"), \":\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"crane blob ttl.sh/<redacted>.sbom@$(crane manifest ttl.sh/<redacted>.sbom | jq -r \\\".layers[0].digest\\\")\\n\")), mdx(\"p\", null, \"You'll get the following logs:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"SPDXVersion: SPDX-2.2\\nDataLicense: CC0-1.0\\nSPDXID: SPDXRef-DOCUMENT\\nDocumentName: example-app\\nDocumentNamespace: http://spdx.org/spdxpackages/example-app\\nCreator: Tool: ko v0.11.2\\nCreated: 1970-01-01T00:00:00Z\\n\\n##### Package representing example-app\\n\\nPackageName: example-app\\nSPDXID: SPDXRef-Package-example-app\\nPackageSupplier: Organization: example-app\\nPackageDownloadLocation: https://example-app\\nFilesAnalyzed: false\\nPackageHomePage: https://example-app\\nPackageLicenseConcluded: NOASSERTION\\nPackageLicenseDeclared: NOASSERTION\\nPackageCopyrightText: NOASSERTION\\nPackageLicenseComments: NOASSERTION\\nPackageComment: NOASSERTION\\n\\nRelationship: SPDXRef-DOCUMENT DESCRIBES SPDXRef-Package-example-app\\n\\n\\nRelationship: SPDXRef-Package-example-app DEPENDS_ON SPDXRef-Package-github.com.fatih.color-v1.13.0\\n\\n##### Package representing github.com/fatih/color\\n\\nPackageName: github.com/fatih/color\\nSPDXID: SPDXRef-Package-github.com.fatih.color-v1.13.0\\nPackageVersion: v1.13.0\\nPackageSupplier: Organization: github.com/fatih/color\\nPackageDownloadLocation: https://proxy.golang.org/github.com/fatih/color/@v/v1.13.0.zip\\nFilesAnalyzed: false\\nPackageChecksum: SHA256: f0b3987352983cf9b228cb8df105760cd45635b2e8e8b67488bb3cfa6947e77c\\nPackageLicenseConcluded: NOASSERTION\\nPackageLicenseDeclared: NOASSERTION\\nPackageCopyrightText: NOASSERTION\\nPackageLicenseComments: NOASSERTION\\nPackageComment: NOASSERTION\\nRelationship: SPDXRef-Package-example-app DEPENDS_ON SPDXRef-Package-github.com.mattn.go-colorable-v0.1.9\\n\\n<snip...>\\n\")), mdx(\"p\", null, \"This data follows \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://spdx.dev/\"\n  }, \"SPDX\"), \" format, which has been promoted by Linux Foundation.\"), mdx(\"h2\", {\n    \"id\": \"exercise-2-build-an-alpine-based-container-image-using-apko\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#exercise-2-build-an-alpine-based-container-image-using-apko\",\n    \"aria-label\": \"exercise 2 build an alpine based container image using apko permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Exercise 2: Build an Alpine-based Container Image Using \", mdx(\"inlineCode\", {\n    parentName: \"h2\"\n  }, \"apko\")), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"apko\"), \" is a tool to build and publish OCI container images built from APK packages. For instance, the following commands generate a container image with SBoM:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"# in fish\\nset IMAGE_NAME ttl.sh/(uuidgen | tr [:upper:] [:lower:]):4h\\ndocker run -v \\\"$PWD\\\":/work distroless.dev/apko build apko-src/alpine-base.yaml $IMAGE_NAME apko-alpine.tar\\ncrane push apko-alpine.tar $IMAGE_NAME\\n\\n# in bash\\nIMAGE_NAME=ttl.sh/$(uuidgen | tr [:upper:] [:lower:]):4h\\ndocker run -v \\\"$PWD\\\":/work distroless.dev/apko build apko-src/alpine-base.yaml $IMAGE_NAME apko-alpine.tar\\ndocker load < apko-alpine.tar\\n\")), mdx(\"p\", null, \"After \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"apko\"), \" exit successfully, you'll find some files like \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"sbom-*\"), \" in your current directory. Check them out to see what they include.\"), mdx(\"h2\", {\n    \"id\": \"exercise-optional-review-other-build-tools\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#exercise-optional-review-other-build-tools\",\n    \"aria-label\": \"exercise optional review other build tools permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Exercise (Optional): Review other build tools\"), mdx(\"p\", null, \"See other build tools like \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://buildpacks.io/\"\n  }, \"Buildpacks\"), \", \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://bazel.build/\"\n  }, \"Bazel\"), \", \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/anchore/syft\"\n  }, \"Syft\"), \", \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/aquasecurity/trivy\"\n  }, \"Trivy\"), \", \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.fossology.org/\"\n  }, \"FOSSology\"), \", \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/oss-review-toolkit/ort\"\n  }, \"OSS Review Toolkit\"), \", etc.\"));\n}\n;\nMDXContent.isMDXComponent = true;","headings":[{"depth":2,"value":"Preliminaries"},{"depth":2,"value":"Exercise 1: Build a Container Image with a Go Application Using ko"},{"depth":3,"value":"Build"},{"depth":3,"value":"Review SBoM"},{"depth":2,"value":"Exercise 2: Build an Alpine-based Container Image Using apko"},{"depth":2,"value":"Exercise (Optional): Review other build tools"}]}},"pageContext":{"slug":"/chapters/hardening-builds/","prev":{"label":"Hardening SCM","link":"/chapters/hardening-scm"},"next":{"label":"Hardening Artifacts","link":"/chapters/hardening-artifacts"},"repositoryEditUrl":"https://github.com/supply-chain-security-book/supply-chain-security-book.github.io/tree/main/src/docs/chapters/hardening-builds/index.mdx","repositoryProvider":"GitHub"}},"staticQueryHashes":["1954253342","2328931024","2501019404","973074209"]}